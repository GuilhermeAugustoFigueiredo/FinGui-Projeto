<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Organizador de Finanças</title>
    <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' 
    rel='stylesheet'>   
    <link rel="stylesheet" href="style.css">
    <!-- declaração da biblioteca jQuery para pegar icones no link 1 -->
</head>
<body>
    <main>
        <!-- Forma Padrão Zerada dos contadores -->
        <div class="resumo">
            <div> Entrada: R$ <span class="entradas">0.00</span> </div>
            <div> Saída: R$ <span class="saidas">0.00</span> </div>
            <div> Total: R$ <span class="total">0.00</span> </div>
        </div>

        <!-- Campo vazio adicionar um novo item-->
        <div class="novoItem">
            <div>
                <!-- input para inserir a descrição do item -->
                <label>Descrição</label>
                <input type="text" id="descricao">
            </div>
            <div>
                <!-- input para inserir o valor do item -->
                <label>Valor</label>
                <input type="number" id="valor">
            </div>
            <div>
                <!-- select para ver se o item é uma Entrada ou Saída -->
                <label>Tipo</label>
                <select id="tipo">
                    <option>Entrada</option>
                    <option>Saída</option>
                </select>
            </div>
            <!-- Botão com a função 'adicionarItem()' quando for clicado -->
            <button onclick="adicionarItem()">Adicionar Item</button>
        </div>

        <!-- Tabela que exibe os itens adicionados -->
        <div class="divTabela">
            <table>
                <thead>
                    <!-- PARTE MAIS DIFICIL DO HTML, ENTENDER TABELA -->
                    <!-- thead - Cabeçalho da tabela | th - Table Header (Colunas) | tr - Table Row (Linhas) -->
                     <!-- dentro da linha tr, tem os campos descrição, valor, tipo e excluir, semelhante ao banco de dados -->
                    <tr> 
                        <th>Descrição</th>
                        <th>Valor</th>
                        <th>Tipo</th>
                        <th>Excluir</th>
                    </tr>
                </thead>

                <!-- Corpo da tabela vazio onde os itens inseridos pelo usuario serão exibidos -->
                <tbody></tbody>
            </table>
        </div>
    </main>


    <script>
        // Declaração de var constante que seleciona o corpo da tabela (tbody) onde os itens serão exibidos
        const corpoTabela = document.querySelector("tbody");

        // - - - - - Seleciona os elementos dos inputs do formulário
        const descricao = document.getElementById("descricao");
        const valor = document.getElementById("valor");
        const tipo = document.getElementById("tipo");

        // - - - - - Seleciona os elementos que mostram os totais de entradas, saídas e o total geral -- OBS: tem o . antes do nome dois se tratam de classes, e o . serve pra ser um seletor de classe, no caso das Spans no html
        const entradas = document.querySelector(".entradas");
        const saidas = document.querySelector(".saidas");
        const totalGeral = document.querySelector(".total");

        // Criação de um array let para armazenar os itens -- OBS: é declarado como um let pois é mais adequado devido as propriedas unicas da let, como ela existiu apenas no bloco onde foi criada
        let itens = [];

        // Função para adicionar um novo item na lista
        function adicionarItem() {
            // Validação se todos os campos foram preenchidos, caso não, exibir o alerta pra preencher todos os campos
            if (descricao.value === "" || valor.value === "" || tipo.value === "") {
                return alert("Preencha todos os campos!");
            }

            // Adiciona o novo item ao array com suas propriedades (descrição, valor e tipo)  funciona assim: dentro do array itens, o .push coloca os calores inseridos nele no final do array, ou seja ele pega a desc valor e tipo e coloca isso no final do array como se fosse 1, 2, 3
            itens.push({
                descricao: descricao.value, 
                valor: parseFloat(valor.value).toFixed(2), 
                tipo: tipo.value
            });

            // Recarrega os itens para exibir o novo item adicionado, função essa que sera declarada depois
            carregarItens(); 

            // Limpa os campos do formulário após adicionar o item, assim redefinindo e permitindo o usuario a inserir outro item
            descricao.value = ""; 
            valor.value = "";
        }

        // Função para excluir um item da lista
        function excluirItem(indice) {
            // Remove o item do array com base no índice OBS: o splice remove ou altera elementos do array, esse no caso ele faz a função de excluir com base no indice
            itens.splice(indice, 1);
            // Recarrega os itens para atualizar a tabela
            carregarItens();
        }

        // Função de carregar os itens na tabela e atualizar os totais
        function carregarItens() {
            // Limpa o conteúdo da tabela antes de recarregar
            corpoTabela.innerHTML = "";

            // forEach (para cada) faz uma função sobre os itens e cria uma linha na tabela para cada um com base no indice do array item
            itens.forEach((item, indice) => {
                // Cria uma nova linha para cada item
                let linha = document.createElement("tr");

                // Define o conteúdo da let linha com os dados do item (descrição, valor, tipo e botão de excluir)
                linha.innerHTML = `
                    <td>${item.descricao}</td>
                    <td>R$ ${item.valor}</td>
                    <td>${item.tipo === "Entrada" ? '<i class="bx bxs-chevron-up-circle"></i>' : '<i class="bx bxs-chevron-down-circle"></i>'}</td>
                    <td><button onclick="excluirItem(${indice})"><i class='bx bx-trash'></i></button></td>
                `;

                // Adiciona a linha à no corpo da tabela e atualiza
                corpoTabela.appendChild(linha);
            });

            // Chama a função para atualizar os totais de entradas, saídas e o total geral
            atualizarTotais();
        }

        // Função de calcular e atualizar os totais de entradas, saídas e o total
        function atualizarTotais() {
            // Filtra os itens que são "Entrada" e soma seus valores
            const totalEntradas = itens.filter(item => item.tipo === "Entrada")
            .reduce((acumulado, item) => acumulado + Number(item.valor), 0).toFixed(2);

            // Filtra os itens que são "Saída" e soma seus valores
            const totalSaidas = itens.filter(item => item.tipo === "Saída")
            .reduce((acumulado, item) => acumulado + Number(item.valor), 0).toFixed(2);

            // Atualiza o texto das entradas e saídas com os valores calculados
            entradas.innerText = totalEntradas;
            saidas.innerText = totalSaidas;

            // Calcula o total (entradas - saídas) e atualiza o valor no HTML
            totalGeral.innerText = (totalEntradas - totalSaidas).toFixed(2);
        }
    </script>
</body>
</html>
